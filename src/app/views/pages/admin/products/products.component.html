<nav class="page-breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <h3>
                <div class="d-flex flex-row bd-highlight">
                    <div class="bd-highlight"><i class="mdi mdi-basket"></i></div>
                    <div class="bd-highlight ms-2 mt-2px">Products</div>
                </div>
            </h3>
        </li>
    </ol>
</nav>

<div class="row">
    <div class="col-md-12 stretch-card">
        <div class="card">
            <div class="card-body">
                <div class="mb-3">
                    <button class="btn btn-primary btn-lg" (click)="initializeProductForm(productModal)">
                        Add product <span style="font-size: 19px;font-weight: 500px;">+</span>
                    </button>
                </div>
                <p-table #pt [value]="products" [rows]="5" [paginator]="true"
                    [rowHover]="true" dataKey="id" [globalFilterFields]="['nome_prodotto']"
                    [rowsPerPageOptions]="[5,10,25,50]" [showCurrentPageReport]="true"
                    responsiveLayout="stack" styleClass="p-datatable-striped">
                    <ng-template pTemplate="caption">
                        <div class="row">
                            <div class="col-lg-12 col-md-12 col-12 text-lg-end text-start p-2">
                                <div class="p-ai-center p-jc-between">
                                    <span class="p-input-icon-right">
                                        <i class="pi pi-search"></i>
                                        <input pInputText type="text" id="globalFilter"
                                            (input)="pt.filterGlobal(searchedValue($event), 'contains')"
                                            placeholder="Search product" />
                                    </span>
                                </div>
                            </div>
                        </div>
                    </ng-template>
                    <ng-template pTemplate="header">
                        <tr>
                            <th>
                                ID
                            </th>
                            <th>
                                Product
                            </th>
                            <!-- <th>
                                Algorithm type
                            </th>
                            <th>
                                Reference temperature 1 (°C)
                            </th>
                            <th>
                                SL at reference temperature 1 (days)
                            </th>
                            <th>
                                Reference temperature 2 (°C)
                            </th>
                            <th>
                                SL at reference temperature 2 (days)
                            </th>
                            <th>
                                Reference temperature 3 (°C)
                            </th>
                            <th>
                                SL at reference temperature 3 (days)
                            </th>
                            <th>
                                K1
                            </th>
                            <th>
                                K2
                            </th>
                            <th>
                                K3
                            </th> -->
                            <th>
                                Actions
                            </th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-product let-columns="columns" let-rowIndex="rowIndex">
                        <tr>
                            <td>
                                <span class="p-column-title">ID</span>
                                    {{ product?.id }}
                            </td>
                            <td>
                                <span class="p-column-title">Product</span>
                                    {{ product?.nome_prodotto }}
                            </td>
                            <!-- <td>
                                <span class="p-column-title">Algorithm type</span>
                                    {{ (product?.algorithm_type == 1) ? '1 - Exponential base algorithm' : 
                                        ((product?.algorithm_type == 2) ? '2 - Arrhenius base algorithm' : 
                                            ((product?.algorithm_type == 3) ? '3 - Square root base algorithm' : '')) }}
                            </td>
                            <td>
                                <span class="p-column-title">Reference temperature 1 (°C)</span>
                                    {{ product?.reference_temperature_1 }}
                            </td>
                            <td>
                                <span class="p-column-title">SL at reference temperature 1 (days)</span>
                                    {{ product?.shelflife_rt_1 }}
                            </td>
                            <td>
                                <span class="p-column-title">Reference temperature 2 (°C)</span>
                                    {{ product?.reference_temperature_2 }}
                            </td>
                            <td>
                                <span class="p-column-title">SL at reference temperature 2 (days)</span>
                                    {{ product?.shelflife_rt_2 }}
                            </td>
                            <td>
                                <span class="p-column-title">Reference temperature 3 (°C)</span>
                                    {{ product?.reference_temperature_3 }}
                            </td>
                            <td>
                                <span class="p-column-title">SL at reference temperature 3 (days)</span>
                                    {{ product?.shelflife_rt_3 }}
                            </td>
                            <td>
                                <span class="p-column-title">K1</span>
                                    {{ product?.k1 }}
                            </td>
                            <td>
                                <span class="p-column-title">K2</span>
                                    {{ product?.k2 }}
                            </td>
                            <td>
                                <span class="p-column-title">K3</span>
                                    {{ product?.k3 }}
                            </td> -->
                            <td>
                                <button class="btn btn-outline-primary me-2" (click)="initializeProductForm(productModal, product?.id);">Edit</button>
                                <button class="btn btn-danger" (click)="deleteProduct(product?.id)">Delete</button>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="7" class="text-center"><b>No product found.</b></td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>
    </div>
</div>

<!-- Modals -->
<ng-template #productModal let-modal>
    <div class="modal-header">
        <div class="ms-4 mt-2 mb-2">
            <h4>
                <div class="d-flex flex-row bd-highlight">
                    <div class="bd-highlight"><i class="mdi mdi-basket"></i></div>
                    <div class="bd-highlight ms-2">{{ (product?.id ? 'Edit' : 'Add') + ' product' }} </div>
                    <button id="closeModal" pButton pRipple icon="pi pi-times" class="close-button" (click)="resetHumidityForm();modal.close('by: close icon')"></button>
                </div>
            </h4>
        </div>
    </div>
    <div class="modal-body ms-2">
        <div class="row">
            <div class="col-md-12">
                <div class="row mt-2">
                    <div class="col-md-12">
                        <form [formGroup]="productForm">
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="mb-3">
                                        <label class="form-label">Product<span class="text-danger">*</span></label>
                                        <input *ngIf="trickProducts.length == 0" class="form-control bg-transparent" type="text"
                                            placeholder="Product name" formControlName="nome_prodotto">
                                        <span *ngIf="f.nome_prodotto.touched && f.nome_prodotto.errors?.required" class="validation-error">
                                            Required field.
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-center mt-3">
                                <button type="submit" (click)="saveProduct()" [disabled]="productForm.invalid" class="btn btn-primary fs-4">Save</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-template>
